<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<title>Game Changers: Immunity Challenge</title>

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Montserrat:wght@500;700&display=swap" rel="stylesheet">

<style>
/* ========== ANCHOR: THEME ========== */
:root{
  --bg:#0c1a14; --bg2:#0e231a;
  --sand:#e0cfa4; --ink:#1c1206; --lightink:#f7f3ea; --muted:#cbbd97;
  --accent:#3ac47d; --accent2:#1ba6e0; --fire:#ff8a00; --bad:#ff6b6b;
  --grid:#2d4a3d; --rope:#c9a86a; --wood1:#6b3e1e; --wood2:#90562a;
  --ln-blue:#0a66c2; --ln-ink:#1f2328; --ln-muted:#666d76; --ln-bg:#f3f2ef; --ln-card:#fff; --ln-border:#e0e3e7;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html{scroll-behavior:smooth;-webkit-text-size-adjust:100%}
body{
  margin:0; color:var(--lightink);
  font:16px/1.6 Montserrat, system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
  background:
    radial-gradient(1200px 700px at 80% -100px, rgba(27,166,224,.18), transparent 60%),
    radial-gradient(1000px 600px at -10% 120%, rgba(58,196,125,.15), transparent 60%),
    linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%);
}
.wrap{max-width:720px;margin:0 auto;padding:1.25rem 1rem 5.5rem}

header{text-align:center;margin:0 0 .5rem}
header h1{
  margin:.25rem 0 .3rem; font-family:"Cinzel Decorative", Georgia, serif;
  letter-spacing:.03em; font-size:clamp(1.6rem,5.6vw,2.2rem);
  text-shadow:0 2px 0 rgba(0,0,0,.25), 0 6px 22px rgba(0,0,0,.35);
}
header .sub{color:var(--muted); margin:.25rem auto .35rem}
header::before{
  content:"OUTWIT  •  OUTPLAY  •  OUTLAST";
  display:inline-block; margin:.25rem auto .35rem; padding:.35rem .9rem;
  font-weight:700; font-size:.78rem; letter-spacing:.18em;
  color:#082314; background:linear-gradient(180deg,#f5e5be,#d9c28f);
  border-radius:999px; border:2px solid rgba(0,0,0,.25);
  box-shadow:inset 0 0 0 2px rgba(255,255,255,.25), 0 6px 18px rgba(0,0,0,.35);
}

.card{
  position:relative; background:
    linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)),
    radial-gradient(600px 220px at 50% -10%, rgba(255,255,255,.08), transparent 60%);
  border-radius:18px; padding:1rem 1rem; margin:.9rem 0;
  box-shadow:0 16px 35px rgba(0,0,0,.35);
  border:10px solid transparent;
  border-image:repeating-linear-gradient(45deg, var(--rope) 0 8px, #b38e54 8px 16px) 10;
}
.stage{display:none}
.stage.active{display:block}

.small{color:var(--muted)}
.ok{color:#7ef7b0} .bad{color:#ff6b6b}
.row{display:grid;grid-template-columns:1fr 1fr auto;gap:.6rem;margin-top:.8rem}

/* Stage 3 stacked inputs */
#stage3 .row{grid-template-columns:1fr auto}
#stage3 .row:first-of-type{grid-template-columns:1fr}

input[type=text], input[type=number]{
  width:100%; min-height:48px; padding:.9rem .95rem; font-size:1rem; outline:none; color:#f4f0e4;
  background:
    linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,.28)),
    repeating-linear-gradient(90deg, rgba(255,255,255,.06) 0 10px, rgba(0,0,0,.06) 10px 20px);
  border:1px solid rgba(255,255,255,.18); border-radius:12px; box-shadow:inset 0 1px 2px rgba(0,0,0,.35);
}
input::placeholder{color:rgba(250,245,235,.6)}

button{
  border:0; min-height:48px; padding:1rem 1.1rem; font-weight:800; font-size:1rem; cursor:pointer;
  color:#fff; text-shadow:0 1px 0 rgba(0,0,0,.35);
  background:
    linear-gradient(180deg, rgba(255,255,255,.12), rgba(0,0,0,.12)),
    linear-gradient(180deg, var(--wood2), var(--wood1));
  border-radius:12px;
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.15), 0 8px 18px rgba(0,0,0,.35), 0 0 0 3px rgba(27,166,224,.18);
  transition:transform .04s ease, box-shadow .2s ease;
}
button:active{transform:translateY(1px)}
.mutebtn{
  background:
    linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.18)),
    linear-gradient(180deg, #2a3a34, #1d2a25);
  color:#dfe7dd; box-shadow:inset 0 0 0 1px rgba(255,255,255,.1), 0 6px 14px rgba(0,0,0,.35);
}

.linkrow{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.6rem}
.linkrow a{
  background:linear-gradient(180deg, #425248, #2a3a34);
  color:#e6f3ef; padding:.7rem .95rem; border-radius:12px; text-decoration:none; font-weight:700;
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.1), 0 6px 14px rgba(0,0,0,.35);
}

.hint{color:#e8dcbb;font-size:.95rem;margin-top:.5rem;display:none}
.hidden{display:none !important}

/* ========== ANCHOR: STAGE 2 REPORT STYLES ========== */
/* adjusted spacing for mobile typing comfort */
.gridwrap{position:relative;width:100%;border-radius:16px;overflow:hidden;border:1px solid rgba(255,255,255,.12); margin-top:.6rem}
.report{
  background:transparent; color:var(--lightink); padding:14px 12px 48px; /* extra bottom pad */
  min-height:36vh; /* slightly shorter so inputs + keyboard don't fully cover */
  font:15px/1.55 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
}
.report h3{margin:0 0 8px 0; font-size:18px}
.report .meta{color:rgba(255,255,255,.65); font-size:12px; margin-bottom:8px}
.report .sec{margin-top:10px}
.report .sec h4{margin:0 0 6px 0; font-size:15px; color:#dfe7dd}
.report .sec p{margin:0 0 8px 0}
.report ul{margin:8px 0 0 18px; padding:0}
.report li{margin:6px 0}
.report table{width:100%; border-collapse:collapse; margin-top:6px; font-size:14px; color:var(--lightink)}
.report th,.report td{border:1px solid rgba(255,255,255,.16); padding:6px 8px; text-align:left; background:rgba(255,255,255,.02)}
.report tfoot td{font-size:12px; color:rgba(255,255,255,.7)}
.report .note{color:rgba(255,255,255,.7); font-size:12px}

/* Hidden coordinate glyphs: subtle in light mode; bright red glow in dark mode */
.coord{color:var(--lightink); font-weight:700; user-select:none}
@media (prefers-color-scheme: dark){
  .coord{color:#ff4d5e; text-shadow:0 0 6px rgba(255,77,94,.35)}
}

/* Greenscreen winner */
.greenscreen{position:fixed;inset:0;display:none;align-items:center;justify-content:center;text-align:center;
  background:linear-gradient(180deg, #25e07f 0%, #16a34a 60%, #11823b 100%); color:#052e12; box-shadow:inset 0 0 120px rgba(0,0,0,.25)}
.greenscreen.active{display:flex}
.greenscreen h2{font-family:"Cinzel Decorative", Georgia, serif; font-size:clamp(1.9rem,7vw,3.2rem); margin:.5rem 0 0;
  text-shadow:0 2px 0 rgba(255,255,255,.25), 0 8px 22px rgba(0,0,0,.45)}
.greenscreen .sub{color:#0b3d22}

/* ========== ANCHOR: LINKEDIN OVERLAY ========== */
.linkedin-app{
  position:fixed; inset:0; background:var(--ln-bg); color:var(--ln-ink);
  font:14px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
  display:none; flex-direction:column;
  z-index:10000;
}
.linkedin-app.active{display:flex}
.linkedin-app button{color:var(--ln-ink); text-shadow:none; background:#fff}
.linkedin-app .ln-btn.primary{color:#fff; background:var(--ln-blue); border-color:transparent}

.ln-topbar{
  position:sticky; top:0; z-index:7; height:56px; background:var(--ln-blue); color:#fff;
  display:flex; align-items:center; gap:10px; padding:0 12px;
}
#lnBack{display:none; border:0}
.ln-backbig{
  display:flex; align-items:center; gap:8px; background:#fff; color:#0a66c2; border:1px solid #d3e3ff;
  padding:6px 12px; border-radius:999px; font-weight:800;
}
.ln-badge{display:inline-grid;place-items:center;width:26px;height:26px;border-radius:4px;background:#fff;color:var(--ln-blue);font-weight:800}
.ln-search{flex:1;display:flex;align-items:center;gap:8px;background:#eaf3fe;border-radius:6px;padding:6px 10px}
.ln-search input{flex:1;border:0;outline:none;background:transparent;font:inherit; color:#111}

/* Toast */
.ln-toast{
  position:fixed; left:12px; right:12px; top:64px; z-index:8;
  background:#fff; border:1px solid #ffd6d6; color:#7a2121;
  box-shadow:0 6px 18px rgba(0,0,0,.08); border-radius:10px; padding:10px 12px;
  display:none; font-weight:700;
}
.ln-toast.show{display:block; animation:toastfade .25s ease}
@keyframes toastfade{from{transform:translateY(-6px);opacity:0}to{transform:none;opacity:1}}

/* Mission banner (pill + wrapped text) */
.ln-taskbar{
  position:sticky; top:56px; z-index:6;
  background:#fff; border-bottom:1px solid var(--ln-border);
  padding:10px 12px; display:flex; align-items:center; gap:10px;
}
.ln-taskbar .tag{
  background:#eaf3fe; color:#1f2328; border:1px solid #d3e3ff;
  padding:2px 8px; border-radius:999px; font-size:11px; font-weight:700; flex:0 0 auto;
}
.mission-text{
  flex:1 1 auto; font-weight:800; font-size:14px; line-height:1.25;
  text-align:left; white-space:normal; letter-spacing:0; word-spacing:0;
}

.ln-screen{flex:1; overflow:auto; -webkit-overflow-scrolling:touch}
.ln-card{background:#fff;border:1px solid var(--ln-border);border-radius:8px;box-shadow:0 1px 0 rgba(0,0,0,.05); overflow:hidden; margin:12px}
.ln-pad{padding:12px}
.ln-meta{color:var(--ln-muted); font-size:12px}

/* ========== ANCHOR: Profile header layout & spacing ========== */
.ln-cover{height:96px;background:linear-gradient(135deg,#dfeafb,#d5f2ea)}
.ln-head{display:flex; align-items:flex-start; gap:12px}
.ln-ava{
  width:74px;height:74px;border-radius:50%;
  background:#fff; display:grid; place-items:center; margin-top:-36px;
  box-shadow:0 1px 0 rgba(0,0,0,.06), 0 0 0 3px #fff, 0 0 0 5px #dfe9f7;
  flex:0 0 74px;
}
.ln-ava .emo{font-size:32px; line-height:1}
.ln-head-main{
  display:flex; flex-direction:column; align-items:flex-start;
  gap:6px; width:100%; min-width:0;
}
.ln-name{font-weight:800; font-size:18px}
.ln-headline{color:#6b7480; font-size:13px}

/* submeta row under headline */
.ln-submeta{
  color:#6b7480;
  font-size:12px;
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}
.ln-submeta span::after{
  content:"•";
  margin:0 6px;
  color:#c3c7ce;
}
.ln-submeta span:last-child::after{content:""}

/* connections line bold on its own row */
.ln-connections-line{
  font-weight:800;
  font-size:12px;
  color:#0a2540;
}

/* button bar */
.ln-buttonbar{display:flex; gap:8px; flex-wrap:wrap; margin-top:4px}
.ln-btn{
  border:1px solid var(--ln-border); padding:8px 12px; border-radius:999px;
  font-weight:700; font-size:13px; background:#fff; cursor:pointer;
}
.ln-btn.blue{
  background:#0a66c2; color:#fff; border-color:#0a66c2;
  box-shadow:0 1px 0 rgba(0,0,0,.06);
}
.ln-btn.ghost{
  background:#fff; color:#0a66c2; border-color:#b7d1f6;
}
.ln-more{border-radius:999px}

/* Sections */
.ln-section-title{font-weight:800; margin:10px 12px 0 12px}
.ln-section{background:#fff; border-top:1px solid var(--ln-border); padding:10px 12px}

/* Rows base */
.ln-result{display:flex; gap:12px; text-align:left; background:#fff}
.ln-miniava{
  width:48px;height:48px;border-radius:50%; background:#fff; display:grid; place-items:center; flex:0 0 48px;
  box-shadow:0 1px 0 rgba(0,0,0,.06), 0 0 0 2px #fff, 0 0 0 3px #e9eef7;
}
.ln-miniava .emo{font-size:24px; line-height:1}
.ln-result .label{min-width:0}
.ln-result .name{font-weight:700; font-size:15px; color:#0a2540}
.ln-result .headline{font-size:13px;color:#434a54}
.ln-result .loc{font-size:12px;color:#6b7480; margin-top:2px}
.ln-result .smallrow{display:flex; gap:8px; align-items:center; color:#6b7480; font-size:12px; margin-top:4px}
.ln-result svg{vertical-align:-2px}

/* Experience */
.ln-explist .ln-exprow{padding:14px 0; border-top:1px solid var(--ln-border)}
.ln-explist .ln-exprow:first-child{border-top:0}

/* Connections list */
.ln-connlist{padding-top:8px}
.ln-connlist .ln-connrow{
  padding:12px; border:1px solid var(--ln-border); border-radius:12px;
  margin:10px 0; box-shadow:0 2px 8px rgba(10,102,194,.06);
  display:flex; gap:12px; align-items:center;
}
.ln-connrow[role="button"]{cursor:pointer}

/* Pills, highlight, activity, edu */
.ln-pills{display:flex; flex-wrap:wrap; gap:8px}
.ln-pill{padding:6px 10px; font-size:12px; border-radius:16px; border:1px solid #e6ebf2; background:#f7f9fc}
.ln-highlight{display:flex; align-items:center; gap:8px; padding:10px 0; border-top:1px solid var(--ln-border)}
.ln-highlight:first-child{border-top:0}
.ln-activity{padding:10px 0; border-top:1px solid var(--ln-border)}
.ln-activity:first-child{border-top:0}
.ln-activity .title{font-weight:700}
.ln-activity .meta{font-size:12px; color:#6b7480}
.ln-edurow{padding:10px 0; border-top:1px solid var(--ln-border)}
.ln-edurow:first-child{border-top:0}

/* Bottom tabs */
.ln-bottom{
  height:54px; background:#fff; border-top:1px solid var(--ln-border);
  display:flex; align-items:center; justify-content:space-around;
}
.ln-tab{font-size:12px; color:#5a646e; padding:6px 10px; border-radius:8px}
.ln-tab:hover{background:#f6f8fb}

/* Centered Sheet (Success Modal) */
.ln-sheet{
  position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
  background:#fff; border-radius:14px; border:1px solid var(--ln-border);
  box-shadow:0 16px 40px rgba(0,0,0,.25); padding:16px; z-index:10002; width:min(420px,90vw);
  display:none;
}
.ln-sheet.active{display:block}
.ln-sheet h3{margin:0 0 10px 0}
.ln-sheet p{margin:0 0 12px 0; color:#444}

/* Backdrop for sheet */
.ln-backdrop{
  position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; z-index:10001;
}
.ln-backdrop.active{display:block}

/* Open LinkedIn button style */
.ln-open-btn{background:#0a66c2; color:#fff; border:0; border-radius:999px; font-weight:800; min-height:48px; padding:.9rem 1.2rem; box-shadow:none}
</style>
</head>
<body>
<div class="wrap">

  <header>
    <h1>Survivor Coronado: Immunity Challenge</h1>
    <!-- ANCHOR: STAGE SUBTITLE (shown only on Stage 1 via JS) -->
    <p id="globalSub" class="sub">Welcome to your first and only immunity challenge — complete each stage of puzzles to move on to the next round.</p>
  </header>

  <!-- =========================
       STAGE 1 — LinkedIn intro
       ========================= -->
  <section id="stage1" class="card stage active">
    <h2>Stage 1 — A Mutual Connections Maze</h2>
    <p class="small">
      You’ve a just taken on a major role in your company’s new sustainability committee. Your first task: put together the firm's first ever LCA, using a past project.
      You've been cleared to bring in an expert consultant to get some advice and examples. You could try cold calling, but then realize this is the perfect opportunity to do some online networking.
      Using your LinkedIn connections, find a mutual connection who can advise your company and provide an example LCA document for reference.
    </p>
    <div class="row" style="grid-template-columns:1fr;">
      <button id="openLinkedInBtn" class="ln-open-btn" type="button">Open LinkedIn</button>
    </div>
  </section>

  <!-- =========================
       STAGE 2 — LCA report reveal
       ========================= -->
  <section id="stage2" class="card stage">
    <h2>Stage 2 — The Hidden Message</h2>
    <p class="small">You've advanced to the second challenge! You are reading through the LCA report you just received when you come across a secret message, hidden within the report. 
        Invisible in the light, but shining in the dark, you'll find the secret coordinates if your phone settings hit the mark.</p>

    <!-- Hint ABOVE the report (appears after delay) -->
    <button id="hintBtn2" class="mutebtn hidden" onclick="toggleHint(2)">Hint</button>
    <div id="hint2" class="hint">Switch your phone into <strong>dark mode</strong> to reveal the coordinates.</div>

    <div class="gridwrap">
      <div class="report" role="article" aria-label="LCA Case Study Report">
        <h3>Case Study LCA — Harbor Offices</h3>
        <div class="meta">
          Prepared by: EcoMetrics Studio<span class="coord" aria-hidden="true">3</span> • DD Snapshot • Reviewer: E. Gomez<span class="coord" aria-hidden="true">7</span>
        </div>

        <div class="sec">
          <h4>Goal & Scope</h4>
          <p>
            Quantify embodied carbon (GWP100)<span class="coord" aria-hidden="true">.</span> for structure & envelope at Design Development per EN 15804+A2.
            System boundary: A1–A3<span class="coord" aria-hidden="true">0</span> with placeholders for A4/A5<span class="coord" aria-hidden="true">4</span>.
          </p>
        </div>

        <div class="sec">
          <h4>Key Inputs</h4>
          <p>
            Concrete mixes with 30–40% SCM, EAF rebar with 95% recycled content<span class="coord" aria-hidden="true">, </span> aluminum cladding with supplier EPDs.
          </p>
        </div>

        <div class="sec">
          <h4>A1–A3 Results (per m² GFA)</h4>
          <table>
            <thead><tr><th>Package</th><th>GWP (kgCO₂e)</th><th>Note</th></tr></thead>
            <tbody>
              <tr><td>Concrete</td><td>152</td><td>SCM substitution</td></tr>
              <tr><td>Rebar</td><td>41</td><td>EAF route</td></tr>
              <tr><td>Cladding</td><td>60</td><td>Manufacturer EPD</td></tr>
            </tbody>
            <tfoot>
              <tr><td colspan="3">Total modeled: 253 kgCO₂e/m²<span class="coord" aria-hidden="true">-121</span></td></tr>
            </tfoot>
          </table>
          <div class="note">
            Uncertainty: cement content & transport distance<span class="coord" aria-hidden="true">.</span>
            References: ISO 14044; CLF guidance<span class="coord" aria-hidden="true">88</span>
          </div>
        </div>

        <!-- Scattered appendix + callouts to distribute remaining hidden digits -->
        <div class="sec">
          <h4>Appendix — Notes & Citations</h4>
          <ul>
            <li>Mix comparison memo v<span class="coord" aria-hidden="true">0</span>.<span class="coord" aria-hidden="true">4</span> archived.</li>
            <li>Internal ref: shipment batch <span class="coord" aria-hidden="true">.</span><span class="coord" aria-hidden="true">88</span> (QA cross-check).</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Inputs as separate lines, in requested order: Latitude, then Longitude, then Submit -->
    <div class="row" style="grid-template-columns:1fr;">
      <input id="lat" type="number" step="any" placeholder="Latitude (e.g., 34.05)">
    </div>
    <div class="row" style="grid-template-columns:1fr;">
      <input id="lon" type="number" step="any" placeholder="Longitude (e.g., -118.25)">
    </div>
    <div class="row" style="grid-template-columns:1fr;">
      <button onclick="checkStage2()">Submit</button>
    </div>

    <div id="msg2" class="small"></div>
  </section>

  <!-- =========================
       STAGE 3 — Earthquake
       ========================= -->
  <section id="stage3" class="card stage">
    <h2>Stage 3 — The M'app'athon</h2>
    <p class="small"><strong>You've found the coordinates! (37.04, -121.88)</strong></p>
    <p class="small">Click on one of the links below to open them in the maps app of your choice. Then identify the famous EQ whose epicenter lay at this point.</p>

    <div class="linkrow" id="mapLinks"></div>

    <div class="row">
      <input id="quakeName" type="text" placeholder="EQ Name">
    </div>
    <div class="row">
      <input id="quakeYear" type="number" inputmode="numeric" step="1" placeholder="Year">
      <button id="btn3" type="button" onclick="checkStage3()">Submit</button>
    </div>

    <div id="msg3" class="small" style="margin-top:.4rem;"></div>
    <button id="hintBtn3" class="mutebtn hidden" onclick="toggleHint(3)">Hint</button>
    <div id="hint3" class="hint">Use your maps app with the coordinates; the epicenter belongs to a well-known Bay Area quake.</div>
  </section>

  <div id="green" class="greenscreen">
    <div>
      <h2>Congratulations — You've Won Immunity!</h2>
      <p class="sub">You completed the challenge. Buzz in!</p>
    </div>
  </div>

</div>

<!-- =======================================================
     LINKEDIN MOBILE OVERLAY
     ======================================================= -->
<div id="linkedinApp" class="linkedin-app" aria-hidden="true">
  <div class="ln-topbar">
    <button id="lnBack" class="ln-backbig" aria-label="Back">
      <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="#0a66c2" d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
      <span>Back</span>
    </button>
    <span class="ln-badge" aria-hidden="true">in</span>
    <div class="ln-search" role="search">
      <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="#426aa8" d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 5L20.5 19l-5-5zM9.5 14C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
      <input id="lnSearch" type="text" placeholder="Search" autocomplete="off" />
    </div>
  </div>

  <div id="lnToast" class="ln-toast" role="status" aria-live="polite">This isn’t the sustainability consultant — check their connections.</div>

  <!-- Mission -->
  <div class="ln-taskbar">
    <span class="tag">Mission</span>
    <div class="mission-text">Use your mutual connections to find a sustainability consultant and connect with them!</div>
  </div>

  <div id="lnScreens" class="ln-screen" tabindex="0" aria-live="polite"></div>

  <div class="ln-bottom" aria-hidden="true">
    <div class="ln-tab">Home</div><div class="ln-tab">My Network</div><div class="ln-tab">Post</div><div class="ln-tab">Notifications</div><div class="ln-tab">Jobs</div>
  </div>

  <!-- Centered success modal + backdrop -->
  <div id="lnBackdrop" class="ln-backdrop" aria-hidden="true"></div>
  <div id="lnSheet" class="ln-sheet" role="dialog" aria-modal="true" aria-labelledby="lnSheetTitle" aria-describedby="lnSheetDesc">
    <h3 id="lnSheetTitle">Success! Consultant Connected</h3>
    <p id="lnSheetDesc">The consultant agrees to share a case study LCA report to kickstart your project.</p>
    <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end">
      <button class="ln-btn blue" id="lnProceed">Open LCA Report</button>
    </div>
  </div>
</div>

<script>
/* ===============================
   GAME CONFIG / HELPERS
   =============================== */
const CONFIG = {
  targetLat: 37.04,
  targetLon: -121.88,
  coordTolerance: 0.01,
  quake: { names:["loma prieta"], year:1989 }
};

const $ = s => document.querySelector(s);
let hintTimer = null;

function toggleHint(n){
  const el = document.querySelector("#hint"+n);
  el.style.display = (el.style.display === "block" ? "none" : "block");
}
function withinTolerance(a,b,t){ return Math.abs(a-b) <= t; }

function startHintTimer(stageNumber){
  if (hintTimer) { clearTimeout(hintTimer); hintTimer = null; }
  ["hintBtn2","hintBtn3"].forEach(id=>{ const b=document.getElementById(id); if(b) b.classList.add("hidden"); });
  const targetBtnId = stageNumber === 2 ? "hintBtn2" : (stageNumber === 3 ? "hintBtn3" : null);
  if (!targetBtnId) return;
  const targetBtn = document.getElementById(targetBtnId);
  hintTimer = setTimeout(()=>{ targetBtn.classList.remove("hidden"); }, 30000);
}

function showStage(id){
  document.querySelectorAll(".stage").forEach(el=>el.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  window.scrollTo({top:0,behavior:"smooth"});
  // Show the subheader only on Stage 1
  const sub = document.getElementById('globalSub');
  if (sub) sub.style.display = (id === 'stage1') ? 'block' : 'none';

  if (id === "stage2") startHintTimer(2);
  if (id === "stage3") startHintTimer(3);
}


function showGreen(){
  document.querySelectorAll(".stage").forEach(el=>el.classList.remove("active"));
  document.getElementById("green").classList.add("active");
  if (hintTimer) { clearTimeout(hintTimer); hintTimer = null; }
}

/* ===============================
   STAGE 2 (coordinates from report)
   =============================== */
function checkStage2(){
  const latVal = parseFloat(document.getElementById("lat").value);
  const lonVal = parseFloat(document.getElementById("lon").value);
  const msg = document.getElementById("msg2");
  if (isNaN(latVal) || isNaN(lonVal)){
    msg.textContent = "Enter both latitude and longitude.";
    msg.className = "small bad"; return;
  }
  const ok = withinTolerance(latVal, CONFIG.targetLat, CONFIG.coordTolerance)
          && withinTolerance(lonVal, CONFIG.targetLon, CONFIG.coordTolerance);
  if (ok){
    msg.textContent = "Correct! Proceeding…"; msg.className="small ok";
    setTimeout(()=>{ showStage("stage3"); renderMapLinks(CONFIG.targetLat, CONFIG.targetLon); },400);
  } else {
    msg.textContent = "Not quite, try again."; msg.className="small bad";
  }
}

function renderMapLinks(lat, lon){
  const wrap = $("#mapLinks"); wrap.innerHTML="";
  const g = document.createElement("a");
  g.href = `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`; g.target="_blank"; g.textContent="Google Maps";
  const a = document.createElement("a");
  a.href = `https://maps.apple.com/?ll=${lat},${lon}&q=Epicenter`; a.target="_blank"; a.textContent="Apple Maps";
  wrap.appendChild(g); wrap.appendChild(a);
}

/* ===============================
   STAGE 3 (quake)
   =============================== */
function checkStage3(){
  const rawName = document.getElementById("quakeName").value || "";
  const rawYear = document.getElementById("quakeYear").value || "";
  const msg = document.getElementById("msg3");
  const year = parseInt(rawYear, 10);
  const nameOnly = rawName.toLowerCase().replace(/earthquake/g,"").replace(/[^a-z\s]/g,"").trim();
  const nameOk = CONFIG.quake.names.some(n => nameOnly.includes(n));
  const yearOk = (year === CONFIG.quake.year);
  if (nameOk && yearOk){
    msg.textContent = "Correct!"; msg.className = "small ok"; setTimeout(()=>{ showGreen(); }, 300);
  } else {
    msg.className = "small bad";
    if (!nameOk && !yearOk) msg.textContent = "We need the quake name and the year.";
    else if (!nameOk)       msg.textContent = "That name doesn’t match. Try another common name.";
    else                    msg.textContent = "Double-check the year.";
  }
}

/* ===============================
   LINKEDIN MOBILE WORKFLOW
   =============================== */
const lnApp     = document.getElementById('linkedinApp');
const lnScreens = document.getElementById('lnScreens');
const lnBackBtn = document.getElementById('lnBack');
const lnSheet   = document.getElementById('lnSheet');
const lnToast   = document.getElementById('lnToast');

function openLinkedIn(){
  lnApp.classList.add('active');
  lnApp.setAttribute('aria-hidden','false');
  if(!lnScreens.dataset.init){ buildAllProfiles(); lnScreens.dataset.init = "1"; }
  showProfile('you', {reset:true});
  lnScreens.focus();
}
function closeLinkedIn(){
  lnApp.classList.remove('active');
  lnApp.setAttribute('aria-hidden','true');
  lnStack = [];
  lnBackBtn.style.display = 'none';
  lnSheet.classList.remove('active');
  lnToast.classList.remove('show');
}

/* helper: shuffle */
function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}

/* Degree-based mutual connections helper */
function degreeFromYou(pid){
  if (pid === 'you') return 0;
  const youConns = new Set(PROFILES.you.connections);
  if (youConns.has(pid)) return 1; // direct
  // second degree: shares any connection with you
  const p = PROFILES[pid];
  if (!p) return 3;
  for (const c of (p.connections||[])){ if (youConns.has(c)) return 2; }
  return 3;
}
function pseudoRandFromId(id){ return (id.charCodeAt(0) + (id.charCodeAt(1)||0) + (id.charCodeAt(2)||0)) % 10; }
function mutualNumber(pid){
  const deg = degreeFromYou(pid);
  const r = pseudoRandFromId(pid);
  if (deg === 1) return 12 + (r % 13);   // 12–24 mutuals for 1st degree
  if (deg === 2) return 3 + (r % 7);     // 3–9 for 2nd degree
  return 1 + (r % 3);                    // 1–3 otherwise
}

/* Engineer network (≥3 connections each; reciprocal where sensible; never list "you" in others) */
const PROFILES = {
  you: {
    id:"you", name:"You", emoji:"🦉",
    headline:"Structural Engineer — 3 yrs",
    about:"Structural Engineer (3 yrs). You’ve stepped into a major role on your company’s sustainability committee and need an environmental (LCA) consultant for a new case study.",
    experience:["Structural Engineer — Firm A (3 yrs)"],
    skills:["Embodied Carbon","LEED","Coordination"],
    loc:"San Francisco Bay Area",
    company:"Firm A", school:"Cal Poly",
    connections:["A","B","G"]
  },
  A: { id:"A", name:"Maya Chen", emoji:"🦊",
    headline:"Structural Engineer — GreenBuild Inc.",
    about:"Low-carbon structure, mix optimization, EPD review.",
    experience:["Structural Engineer — GreenBuild (5 yrs)"], skills:["Concrete Design","EPD Review","LEED"],
    loc:"San Jose, CA", company:"GreenBuild Inc.", school:"UC Berkeley",
    connections:["H","F","C"]
  },
  H: { id:"H", name:"Lina Petrova", emoji:"🐨",
    headline:"Sustainability Engineer — EcoDesign",
    about:"Coordinates certifications and embodied-carbon targets across projects.",
    experience:["Sustainability Engineer — EcoDesign (6 yrs)"], skills:["LEED AP BD+C","Whole-Building LCA","EPDs"],
    loc:"Palo Alto, CA", company:"EcoDesign", school:"Stanford",
    connections:["E","A","J"]
  },
  E: { id:"E", name:"Priya Natarajan", emoji:"🕊️",
    headline:"Environmental Engineer — LCA Consultant",
    about:"Independent consultant focusing on whole-building LCAs and EPD reviews.",
    experience:["Principal — LCA Studio (7 yrs)"], skills:["LCA","EPDs","Carbon Accounting"],
    loc:"San Jose, CA", company:"LCA Studio", school:"UC Davis",
    connections:["H","C","M"], target:true
  },
  B: { id:"B", name:"Noah Kim", emoji:"🐼",
    headline:"Civil Engineer — Water Resources",
    about:"Watershed modeling and stormwater BMPs.",
    experience:["Civil Engineer — FlowWorks (4 yrs)"], skills:["Hydrology","SWMM","H&H"],
    loc:"Oakland, CA", company:"FlowWorks", school:"UCLA",
    connections:["K","C","L"]
  },
  G: { id:"G", name:"Ravi Singh", emoji:"🐢",
    headline:"Municipal Civil Engineer — Site/Grading",
    about:"Permitting and utilities coordination.",
    experience:["Civil Engineer — CityWorks (6 yrs)"], skills:["Grading","Utilities","Permits"],
    loc:"San Mateo, CA", company:"CityWorks", school:"San Jose State",
    connections:["L","K","F"]
  },
  F: { id:"F", name:"Alex Rossi", emoji:"🦌",
    headline:"Structural Engineer — Bridges",
    about:"Long-span steel bridges and fatigue.",
    experience:["Bridge Engineer — SpanWorks (8 yrs)"], skills:["Steel","Fatigue","Inspection"],
    loc:"Sacramento, CA", company:"SpanWorks", school:"Cal Poly",
    connections:["A","L","K"]
  },
  C: { id:"C", name:"Sara Ortiz", emoji:"🦦",
    headline:"Environmental Engineer — Compliance",
    about:"Air & water compliance; embodied-carbon curiosity.",
    experience:["Env Engineer — ClearSky (6 yrs)"], skills:["NEPA","Permitting","EPDs"],
    loc:"San Francisco, CA", company:"ClearSky", school:"UC Santa Cruz",
    connections:["A","B","M"]
  },
  K: { id:"K", name:"Ben Zhao", emoji:"🦉",
    headline:"Civil Engineer — Transportation",
    about:"Complete-streets & transit corridors.",
    experience:["Civil — MetroWorks (5 yrs)"], skills:["Roadway","Transit","Traffic"],
    loc:"Fremont, CA", company:"MetroWorks", school:"UC Irvine",
    connections:["B","G","F"]
  },
  L: { id:"L", name:"Nina Alvarez", emoji:"🦊",
    headline:"Geotechnical Engineer — TerraLab",
    about:"Ground improvement & foundations.",
    experience:["Geotech — TerraLab (7 yrs)"], skills:["Soils","Deep Foundations","Seismic"],
    loc:"San Leandro, CA", company:"TerraLab", school:"UC Davis",
    connections:["G","F","C"]
  },
  J: { id:"J", name:"Marco De Santis", emoji:"🐰",
    headline:"Environmental Engineer — Wastewater",
    about:"Process modeling for WWTPs.",
    experience:["Process Eng — ClearWater (9 yrs)"], skills:["Process","Modeling","Permitting"],
    loc:"San Francisco, CA", company:"ClearWater", school:"USF",
    connections:["H","N","C"]
  },
  M: { id:"M", name:"Amira Hassan", emoji:"🕊️",
    headline:"Energy & Carbon Analyst — Freelance",
    about:"Embodied & operational carbon studies.",
    experience:["Analyst — Freelance (4 yrs)"], skills:["WBLCA","Energy","Carbon"],
    loc:"Sunnyvale, CA", company:"Freelance", school:"SJSU",
    connections:["C","E","K"]
  },
  N: { id:"N", name:"Ethan Morales", emoji:"🐼",
    headline:"Environmental Planner",
    about:"CEQA/NEPA documents and stakeholder engagement.",
    experience:["Planner — GreenPath (6 yrs)"], skills:["CEQA","NEPA","Outreach"],
    loc:"Berkeley, CA", company:"GreenPath", school:"UC Berkeley",
    connections:["J","L","K"]
  }
};

let lnStack = []; // nav stack

/* Utilities to compute a bit of “real” data */
function mutualCountDisplay(p){
  if (p.id === 'you') return "500+ connections";
  const n = mutualNumber(p.id);
  return `${n} mutual connection${n===1?'':'s'}`;
}

function buildAllProfiles(){
  lnScreens.innerHTML = '';

  Object.values(PROFILES).forEach(p => {
    const section = buildProfileSection(p);
    section.style.display = 'none';
    lnScreens.appendChild(section);
  });

  // Sheet & button
  document.getElementById('lnProceed').addEventListener('click', ()=>{
    lnSheet.classList.remove('active');
    closeLinkedIn();
    showStage('stage2');
  });

  // Back button
  lnBackBtn.addEventListener('click', ()=> {
    if(lnStack.length > 1){
      lnStack.pop();
      showProfile(lnStack[lnStack.length-1], {push:false});
    } else {
      closeLinkedIn();
    }
  });

  document.getElementById('lnSearch').addEventListener('focus', (e)=> e.target.placeholder = "Search people, jobs, posts");
}

function iconBriefcase(){return `<svg width="16" height="16" viewBox="0 0 24 24" fill="#6b7480" aria-hidden="true"><path d="M10 4h4a2 2 0 0 1 2 2v2h4a1 1 0 0 1 1 1v3H3V9a1 1 0 0 1 1-1h4V6a2 2 0 0 1 2-2Zm4 4V6h-4v2h4Zm7 6v5a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1v-5h18Z"/></svg>`;}
function iconSchool(){return `<svg width="16" height="16" viewBox="0 0 24 24" fill="#6b7480" aria-hidden="true"><path d="M12 3 1 9l11 6 9-4.91V17h2V9L12 3Zm0 13L5 12.2V16l7 4 7-4v-3.8L12 16Z"/></svg>`;}
function iconSpark(){return `<svg width="16" height="16" viewBox="0 0 24 24" fill="#0a66c2"><path d="M11 2l1.5 5H18l-4 3 1.5 5L11 12l-4.5 3L8 10 4 7h5.5L11 2z"/></svg>`;}
function iconUsers(){return `<svg width="16" height="16" viewBox="0 0 24 24" fill="#0a66c2"><path d="M16 11a4 4 0 10-4-4 4 4 0 004 4Zm-8 1a4 4 0 10-4-4 4 4 0 004 4Zm0 2c-3.33 0-10 1.67-10 5v3h12v-3c0-3.33-6.67-5-10-5Zm8 0c-.53 0-1.14.03-1.79.08A7.2 7.2 0 0120 20v2h4v-3c0-3.33-6.67-5-10-5Z"/></svg>`;}

function showToast(msg, ms=2000){
  lnToast.textContent = msg;
  lnToast.classList.add('show');
  setTimeout(()=> lnToast.classList.remove('show'), ms);
}

function buildProfileSection(p){
  const sec = document.createElement('section');
  sec.id = `prof-${p.id}`;
  sec.className = 'ln-card';
  sec.setAttribute('role','region');
  sec.setAttribute('aria-label', `${p.name} profile`);

  const isYou = p.id === 'you';

  // Header
  const top = document.createElement('div');
top.innerHTML = `
  <div class="ln-cover"></div>
  <div class="ln-pad ln-head">
    <div class="ln-ava" aria-hidden="true"><span class="emo">${p.emoji || "🦉"}</span></div>
    <div class="ln-head-main">
      <div class="ln-name">${p.name} ${p.target ? '✅' : ''}</div>
      <div class="ln-headline">${p.headline}</div>

      <!-- Firm • Education • Location • Mutual/Connections -->
      <div class="ln-submeta">
        <span>${p.company || '—'}</span>
        <span>${p.school || '—'}</span>
        <span>${p.loc || ''}</span>
        <span>${mutualCountDisplay(p)}</span>
      </div>

      <div class="ln-buttonbar">
        ${isYou ? '' : '<button class="ln-btn blue" data-action="connect" aria-label="Connect with ' + p.name + '">Connect</button>'}
        ${isYou ? '' : '<button class="ln-btn ghost" aria-label="Message ' + p.name + '">Message</button>'}
        ${isYou ? '' : '<button class="ln-btn ln-more" aria-label="More actions">···</button>'}
      </div>
    </div>
  </div>
`;

  sec.appendChild(top);

  const about = document.createElement('div');
  about.innerHTML = `
    <div class="ln-section-title">About</div>
    <div class="ln-section">${p.about}</div>
  `;
  sec.appendChild(about);

  /* Highlights */
  const hi = document.createElement('div');
  const mutualText = mutualCountDisplay(p);
  hi.innerHTML = `
    <div class="ln-section-title">Highlights</div>
    <div class="ln-section">
      <div class="ln-highlight">${iconUsers()} <div><strong>${mutualText}</strong></div></div>
      <div class="ln-highlight">${iconSpark()} <div>Open to collaborating on low-carbon projects</div></div>
    </div>
  `;
  sec.appendChild(hi);

  /* Experience */
  const exp = document.createElement('div');
  exp.className = 'ln-explist';
  exp.innerHTML = `
    <div class="ln-section-title">Experience</div>
    <div class="ln-section">
      ${(p.experience||[]).map(e=>`
        <div class="ln-result ln-exprow">
          <div class="ln-miniava"><span class="emo">🧰</span></div>
          <div class="label">
            <div class="name">${e}</div>
            <div class="headline">${p.company || ''}</div>
            <div class="loc">${p.loc || ''}</div>
            <div class="smallrow">${iconBriefcase()} <span>${p.company || '—'}</span> &nbsp;&nbsp; ${iconSchool()} <span>${p.school || '—'}</span></div>
          </div>
        </div>`).join('')}
    </div>
  `;
  sec.appendChild(exp);

  /* Skills */
  const skills = document.createElement('div');
  skills.innerHTML = `
    <div class="ln-section-title">Skills</div>
    <div class="ln-section"><div class="ln-pills">
      ${(p.skills||['Teamwork','Communication']).map(s=>`<span class="ln-pill">${s}</span>`).join('')}
    </div></div>
  `;
  sec.appendChild(skills);

  /* Education */
  const edu = document.createElement('div');
  edu.innerHTML = `
    <div class="ln-section-title">Education</div>
    <div class="ln-section">
      <div class="ln-edurow">
        <div class="title"><strong>${p.school || 'State University'}</strong></div>
        <div class="ln-meta">B.S. Engineering • 4 years</div>
      </div>
    </div>
  `;
  sec.appendChild(edu);

  /* Activity */
  const activity = document.createElement('div');
  activity.innerHTML = `
    <div class="ln-section-title">Activity</div>
    <div class="ln-section">
      <div class="ln-activity">
        <div class="title">${p.name.split(' ')[0]} shared a post</div>
        <div class="meta">• 3d • “Great discussion on whole-building LCA and EPDs.”</div>
      </div>
      <div class="ln-activity">
        <div class="title">${p.name.split(' ')[0]} liked an article</div>
        <div class="meta">• 1w • “Decarbonizing Concrete Mixes”</div>
      </div>
    </div>
  `;
  sec.appendChild(activity);

  /* Connections */
  const conWrap = document.createElement('div');
  conWrap.innerHTML = `<div class="ln-section-title">Connections</div>`;
  const conList = document.createElement('div');
  conList.className = 'ln-section lazy-connections ln-connlist';

  const ids = shuffle(p.connections || []);
  if(ids.length === 0){
    conList.innerHTML = `<div class="ln-meta">No visible connections for this profile.</div>`;
  } else {
    ids.forEach(cid=>{
      const c = PROFILES[cid];
      if(!c || c.id === 'you') return;
      const row = document.createElement('button');
      row.className = 'ln-result ln-connrow';
      row.setAttribute('aria-label', `Open ${c.name} profile`);
      row.innerHTML = `
        <div class="ln-miniava"><span class="emo">${c.emoji || "🦉"}</span></div>
        <div class="label">
          <div class="name">${c.name} ${c.target ? '✅' : ''}</div>
          <div class="headline">${c.headline}</div>
          <div class="loc">${c.loc || ''}</div>
          <div class="smallrow">
            ${iconBriefcase()} <span>${c.company || '—'}</span>
            &nbsp;&nbsp; ${iconSchool()} <span>${c.school || '—'}</span>
          </div>
        </div>
      `;
      row.addEventListener('click', ()=> showProfile(c.id));
      conList.appendChild(row);
    });
  }
  conWrap.appendChild(conList);
  sec.appendChild(conWrap);

  // Connect behavior — allow Sustainability/Environmental Engineer to advance
  const primaryBtn = top.querySelector('[data-action="connect"]');
  if (primaryBtn) {
    primaryBtn.addEventListener('click', ()=>{
      const headline = (p.headline || '').toLowerCase();
      const isSustOrEnv =
        headline.includes('sustainability engineer') ||
        headline.includes('environmental engineer');

      if (p.target || isSustOrEnv){
        lnSheet.classList.add('active');
      } else {
        showToast("This isn’t the sustainability consultant — check their connections.");
        primaryBtn.animate([{transform:'scale(1)'},{transform:'scale(0.98)'},{transform:'scale(1)'}],{duration:180});
      }
    });
  }

  // reveal connections when scrolled into view
  const io = new IntersectionObserver(entries=>{
    entries.forEach(entry=>{
      if(entry.isIntersecting){ conList.classList.add('visible'); io.disconnect(); }
    });
  }, {root:lnScreens, threshold:.1});
  io.observe(conList);

  return sec;
}

function showProfile(id, opts={}){
  if(opts.reset){ lnStack = []; }
  if(opts.push !== false){ lnStack.push(id); }
  lnBackBtn.style.display = lnStack.length > 1 ? 'inline-flex' : 'none';

  Array.from(lnScreens.children).forEach(ch => ch.style.display = 'none');
  const target = document.getElementById(`prof-${id}`);
  if(target){
    target.style.display = 'block';
  } else {
    const root = document.getElementById('prof-you');
    if(root) root.style.display = 'block';
    lnStack = ['you'];
    lnBackBtn.style.display = 'none';
  }
  lnScreens.scrollTo({top:0, behavior:'auto'});
}

/* Bind Open LinkedIn button once DOM is ready */
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.getElementById('openLinkedInBtn');
  if (btn) btn.addEventListener('click', openLinkedIn);
});
</script>
</body>
</html>
